name: Build and Deploy Docusaurus
on:
  push:
    branches:
      - master        # å½“ master åˆ†æ”¯æäº¤
      
env:
    TZ: Asia/Shanghai # è®¾ç½®å½“å‰ç¯å¢ƒæ—¶åŒº
    
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout ğŸ›ï¸
      uses: actions/checkout@master
      
    - name: Use Node.js 16
      uses: actions/setup-node@v3
      with:
        node-version: '16'
        
    - name: Install and Build ğŸ”§ 
      run: |
        npm install
        npm build

    - name: Deploy To UpYunğŸš€
      uses: bwcxyk/upyun-upx-action@1.1
      env:
        bucket: ${{ secrets.UPYUN_BUCKET_NAME }}
        operator: ${{ secrets.OPERATOR }}
        operator_password: ${{ secrets.OPERATOR_PASSWORD }}
        local_path: ./build/
        remote_path: /

    - name: CDN Refresh Cache
      uses: yiyungent/upyun-action@main
      with:
        # åœ¨ Settings->Secrets é…ç½® UPYUN_USERNAME, UPYUN_PASSWORD
        upyun_username: ${{ secrets.UPYUN_USERNAME }}
        upyun_password: ${{ secrets.UPYUN_PASSWORD }}
        # è¦åˆ·æ–°çš„url, æ”¯æŒåŒ¹é…ç¬¦ *, å¤šä¸ªurlä¸­é—´ç”¨ \n éš”å¼€
        refresh_cache_urls: "https://docs.zfile.vip/*"
        
    - name: Notify
      uses: enflo/curl-action@v1.2
      with:
        # curl arguments
        curl: ${{ secrets.NOTIFY_URL }}
