# Docker & Docker Compose

## Docker

### å®‰è£…ä»‹ç»

Docker é•œåƒæ‰˜ç®¡åœ¨ DockerHubï¼šhttps://hub.docker.com/r/zhaojun1998/zfile

:::tip é…ç½®è¯´æ˜

ä¸‹æ–¹é«˜äº®éƒ¨åˆ†ï¼Œå¯è‡ªå®šä¹‰ç«¯å£å’Œæ•°æ®ç›®å½•ï¼š

- ç«¯å£å·ï¼šç¬¬ 2 è¡Œ**å†’å·**å·¦ä¾§çš„ `8080` è¡¨ç¤ºå¯¹å¤–æš´éœ²çš„ç«¯å£å·ï¼Œå¦‚å…¶ä»–ç¨‹åºå ç”¨ï¼Œåˆ™è¯·ä¿®æ”¹ä¸ºå…¶ä»–ç«¯å£å·ã€‚
- æ•°æ®ç›®å½•ï¼šç¬¬ 5 è¡Œçš„ `-v /root/zfile/file:/data/file \` ä¸ºæ˜ å°„å®¿ä¸»æœºæ–‡ä»¶å¤¹ `/root/zfile/file` åˆ°å®¹å™¨å†…çš„ `/data/file` æ–‡ä»¶å¤¹ï¼Œè¿™æ ·éœ€è¦åœ¨ ZFile æ·»åŠ æœ¬åœ°å­˜å‚¨æ—¶ï¼Œå¡«å†™å®¹å™¨å†…ç›®å½• `/data/file` å°±ç­‰åŒäºè®¿é—®å®¿ä¸»æœºçš„ `/root/zfile/file` ç›®å½•äº†ã€‚ è¿™ä¸€è¡ŒæŒ‰ç…§è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹ï¼Œå¦‚æœä¸éœ€è¦æ˜ å°„æœ¬åœ°å­˜å‚¨ï¼Œåˆ™å¯ä»¥åˆ é™¤è¿™ä¸€è¡Œã€‚

:::

```bash showLineNumbers {2,5}
docker run -d --name=zfile --restart=always \
    -p 8080:8080 \
    -v /root/zfile/db:/root/.zfile-v4/db \
    -v /root/zfile/logs:/root/.zfile-v4/logs \
    -v /root/zfile/file:/data/file \
    zhaojun1998/zfile
```

### é…ç½®æ–‡ä»¶æ˜ å°„ {#config}

**å¦‚éœ€æ˜ å°„é…ç½®æ–‡ä»¶**åˆ™éœ€è¦å…ˆåœ¨å®¿ä¸»æœºä¸‹è½½é…ç½®æ–‡ä»¶ï¼Œç„¶åæ˜ å°„åˆ°å®¹å™¨å†…:
ä¸‹è½½ [`application.properties`](https://c.jun6.net/ZFILE/application.properties) æ–‡ä»¶åˆ° `/root` ç›®å½•ä¸‹, æ­¤ç›®å½•å¯è‡ªè¡Œæ›´æ”¹, å‘½ä»¤å¦‚:

```bash showLineNumbers
curl -k -o /root/application.properties https://c.jun6.net/ZFILE/application.properties
```

**ç„¶åå¢åŠ ä¸€ä¸ª `-v` å‚æ•°(è§ä¸‹é¢å€’æ•°ç¬¬äºŒè¡Œ)ï¼Œå°†æ­¤æºæ–‡ä»¶æ˜ å°„åˆ°å®¹å™¨å†…ï¼ˆå¦‚ä¿®æ”¹å®¿ä¸»æœºçš„ `application.properties` ä¸ºå…¶ä»–è·¯å¾„, åˆ™ä¸‹é¢å‘½ä»¤ä¹Ÿè¦ä¸€èµ·ä¿®æ”¹ï¼‰, å¦‚:**

> æç¤º: å¯åŠ¨å®¹å™¨åæ— æ³•ä¿®æ”¹æ–‡ä»¶æ˜ å°„ï¼Œéœ€å…ˆ `docker rm -f zfile` åˆ é™¤å®¹å™¨ï¼Œå†é‡æ–°è¿è¡Œå‘½ä»¤.

```bash showLineNumbers {6}
docker run -d --name=zfile --restart=always \
    -p 8080:8080 \
    -v /root/zfile/db:/root/.zfile-v4/db \
    -v /root/zfile/logs:/root/.zfile-v4/logs \
    -v /root/zfile/file:/data/file \
    -v /root/application.properties:/root/application.properties \
    zhaojun1998/zfile
```


## Docker Compose

### å®‰è£…ä»‹ç»

:::tip é…ç½®è¯´æ˜

ä¸‹æ–¹é«˜äº®éƒ¨åˆ†ï¼Œå¯è‡ªå®šä¹‰ç«¯å£å’Œæ•°æ®ç›®å½•ï¼š

- ç«¯å£å·ï¼šç¬¬ 7 è¡Œ**å†’å·**å·¦ä¾§çš„ `8080` è¡¨ç¤ºå¯¹å¤–æš´éœ²çš„ç«¯å£å·ï¼Œå¦‚å…¶ä»–ç¨‹åºå ç”¨ï¼Œåˆ™è¯·ä¿®æ”¹ä¸ºå…¶ä»–ç«¯å£å·ã€‚
- æ•°æ®ç›®å½•ï¼šç¬¬ 11 è¡Œçš„ `- '/root/zfile/file:/data/file'` ä¸ºæ˜ å°„å®¿ä¸»æœºæ–‡ä»¶å¤¹ `/root/zfile/file` åˆ°å®¹å™¨å†…çš„ `/data/file` æ–‡ä»¶å¤¹ï¼Œè¿™æ ·éœ€è¦åœ¨ ZFile æ·»åŠ æœ¬åœ°å­˜å‚¨æ—¶ï¼Œå¡«å†™å®¹å™¨å†…ç›®å½• `/data/file` å°±ç­‰åŒäºè®¿é—®å®¿ä¸»æœºçš„ `/root/zfile/file` ç›®å½•äº†ã€‚ è¿™ä¸€è¡ŒæŒ‰ç…§è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹ï¼Œå¦‚æœä¸éœ€è¦æ˜ å°„æœ¬åœ°å­˜å‚¨ï¼Œåˆ™å¯ä»¥åˆ é™¤è¿™ä¸€è¡Œã€‚

:::

```yml showLineNumbers {7,11}
version: '3.3'
services:
    zfile:
        container_name: zfile
        restart: always
        ports:
            - '8080:8080'
        volumes:
            - '/root/zfile/db:/root/.zfile-v4/db'
            - '/root/zfile/logs:/root/.zfile-v4/logs'
            - '/root/zfile/file:/data/file'
        image: zhaojun1998/zfile
```


### é…ç½®æ–‡ä»¶æ˜ å°„ {#config2}


**å¦‚éœ€æ˜ å°„é…ç½®æ–‡ä»¶**åˆ™éœ€è¦å…ˆåœ¨å®¿ä¸»æœºä¸‹è½½é…ç½®æ–‡ä»¶ï¼Œç„¶åæ˜ å°„åˆ°å®¹å™¨å†…:
ä¸‹è½½ [`application.properties`](https://c.jun6.net/ZFILE/application.properties) æ–‡ä»¶åˆ° `/root` ç›®å½•ä¸‹, æ­¤ç›®å½•å¯è‡ªè¡Œæ›´æ”¹, å‘½ä»¤å¦‚:

```bash showLineNumbers
curl -k -o /root/application.properties https://c.jun6.net/ZFILE/application.properties
```

**ç„¶åå¢åŠ ä¸€ä¸ª `-v` å‚æ•°(è§ä¸‹é¢å€’æ•°ç¬¬äºŒè¡Œ)ï¼Œå°†æ­¤æºæ–‡ä»¶æ˜ å°„åˆ°å®¹å™¨å†…ï¼ˆå¦‚ä¿®æ”¹å®¿ä¸»æœºçš„ `application.properties` ä¸ºå…¶ä»–è·¯å¾„, åˆ™ä¸‹é¢å‘½ä»¤ä¹Ÿè¦ä¸€èµ·ä¿®æ”¹ï¼‰, å¦‚:**

> æç¤º: å¯åŠ¨å®¹å™¨åæ— æ³•ä¿®æ”¹æ–‡ä»¶æ˜ å°„ï¼Œéœ€å…ˆ `docker rm -f zfile` åˆ é™¤å®¹å™¨ï¼Œå†é‡æ–°è¿è¡Œå‘½ä»¤.

```yml showLineNumbers {12}
version: '3.3'
services:
    zfile:
        container_name: zfile
        restart: always
        ports:
            - '8080:8080'
        volumes:
            - '/root/zfile/db:/root/.zfile-v4/db'
            - '/root/zfile/logs:/root/.zfile-v4/logs'
            - '/root/zfile/file:/data/file'
            - '/root/application.properties:/root/application.properties'
        image: zhaojun1998/zfile
```

-----

## æ›´æ–°ç‰ˆæœ¬

### æ‰‹åŠ¨æ›´æ–°

> å•æ¬¡æ‰‹åŠ¨æ›´æ–°åç§°ä¸º `zfile` çš„å®¹å™¨

```bash showLineNumbers
docker run --rm \
    -v /var/run/docker.sock:/var/run/docker.sock \
    containrrr/watchtower \
    --cleanup \
    --run-once \
    zfile
```

### è‡ªåŠ¨æ›´æ–°

> æ¯ 3600 ç§’ ï¼ˆ1å°æ—¶ï¼‰è‡ªåŠ¨æ£€æµ‹æ›´æ–°åç§°ä¸º `zfile` çš„å®¹å™¨

```bash showLineNumbers
docker run -d \
    --name watchtower \
    --restart always \
    -v /var/run/docker.sock:/var/run/docker.sock \
    containrrr/watchtower \
    --cleanup \
    zfile \
    -i 3600
```

## å¸®æˆ‘å®‰è£…ğŸ”
[æŠ€æœ¯æ”¯æŒ](/support/)
